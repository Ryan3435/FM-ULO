@using GSA.UnliquidatedObligations.BusinessLayer.Data
@using GSA.UnliquidatedObligations.Web.Models
@model GSA.UnliquidatedObligations.Web.Models.UloViewModel

@{
    ViewBag.Title = Model.CurretUnliquidatedObligation.PegasusDocumentNumber;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var currentUloId = Convert.ToInt32(Context.Request.QueryString["uloId"]);
    var currentworkflowId = Convert.ToInt32(Context.Request.QueryString["workflowId"]);
}

<h2>Details</h2>
@Html.Partial("Details/Workflow/_WorkflowDescription", Model.WorkflowViewModel.WorkflowDescriptionViewModel)
<br />
@Html.Partial("Details/Workflow/_AssignedTo", Model.WorkflowViewModel)

@using (Html.BeginForm("Advance", "Ulo", new { uloId = @currentUloId, workflowId = @currentworkflowId }, FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.Partial("Details/_Ulo", Model)
    @Html.Partial("Details/Documents/_Index", Model.WorkflowViewModel.DocumentsViewModel)
    @Html.Partial("Details/_Notes", Model.CurretUnliquidatedObligation.Notes)

    @Html.Partial("Details/Workflow/_Index", Model.WorkflowViewModel)
}

@Html.Partial("Details/Documents/Attachments/_Upload", new UploadViewModel())

@Html.Partial("Details/Workflow/RequestForReassignments/_Index", Model.WorkflowViewModel)


@Html.Partial("Details/Documents/_ViewModals", Model.WorkflowViewModel.DocumentsViewModel.Documents)

<div class="clearfix">
    @Html.ActionLink("Back to List", "Index")
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryform")

    <script>
        function loadDocumentModal(documentId) {
            var url = '@Url.Action("View", "Documents")';
            url += '/?documentId=' + documentId;
            var $div = $("#" + "modal-container-" + documentId);
            var doneFns = Array.prototype.slice.call(arguments);
            doneFns.shift();
            if ($div.length === 0) {
                $div = $(document.createElement('div')).attr('id', "modal-container-" + documentId);
                $("#document-edit-modals").append($div);
            }
            $($div).load(url, function() {
                doneFns.forEach(function(fn) {
                    fn();
                });
            });
        }
    </script>

}